<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="/css/main.css" />
    <script type="text/javascript" src="/js/jquery-1.3.1.min.js"></script>
    <script type="text/javascript" src="/js/jquery.cookie.js"></script>
    <script type="text/javascript" src="/js/rubyzome.js"></script>
    <title><%= @title %></title>
    <script>
        var base='/accounts' ;
        function update_resource(nickname) {
            $.post(
                base+'/'+nickname+'.json', 
                {   l: "adm",
                    p: "adm",
                    nickname: $("#"+nickname).val(), 
                    status: $("#msg"+nickname).val(),
                    password: $("#pw"+nickname).val(), 
                    _method: 'PUT',
                },
                function() {
                    alert("User "+nickname+" updated successfully");
                });
        }

        function delete_resource(nickname) {
            $.post(
                base+'/'+nickname+'.json', 
                {   l: "adm",
                    p: "adm",
                    nickname: nickname, 
                    _method: 'DELETE'
                },
                function() { location.reload(); }
            );
        }

        function create_resource() {
            $.post(
                base+'.json', 
                {   l: "adm",
                    p: "adm",
                    nickname: $("#newnickname").val(), 
                    status: $("#newmsg").val(),
                    password: $("#newpw").val(), 
                    _method: 'POST',
                },
                function() {
                    alert("User "+$("#newnickname").val()+" created successfully");
                });
        }

    </script>
</head>
<body>
    <div id="entete">
        <h1>Accounts</h1>
        <h2>Administrate account here</h2>
    </div>

    <div id="content">
        <div id="actions">
            <div>Edit here to create a new user.</div>
            <table>
                <tr>
                    <th>nickname</th>
                    <td><input type="text" id="newnickname"  value=""/></td>
                </tr>
                <tr>
                    <th>password</th>
                    <td><input type="text" id="newpw"  value="guest"/></td>
                </tr>
                <tr>
                    <th>status</th>
                    <td><input type="text" id="newmsg" value="Welcome new user"/></td>
                </tr>
            </table>
            <div id="actionbutton">
            <span class="button" onclick="create_resource()">add new user</span>
            </div>
        </div>
        <hr/>

        <table>
            <tr>
                <th>nickname</th>
                <th>password</th>
                <th>status</th>
                <th>update</th>
                <th>remove</th>
            </tr>
        <% parity_class = 0 %>
        <% @object.sort{|x,y| x[:nickname] <=> y[:nickname] }.each do |account| %>
            <% nkm=account[:nickname] %>
            <% parity_class=( parity_class+1) %2 %>
            <tr class="r<%=parity_class%>" id="line<%=nkm%>">
                <td><input type="text" id="<%=nkm%>"  value="<%= nkm %>"/></td>
                <td><input type="text" id="pw<%=nkm%>"  value="<%= account[:password] %>"/></td>
                <td><input type="text" id="msg<%=nkm%>" value="<%= account[:status] %>"/></td>
                <td><span class="button"
                        onclick='update_resource("<%=nkm%>")'>update</span></td>
                <td><span class="button" 
                        onclick='delete_resource("<%=nkm%>")'>remove</span></td>
            </td>
        <% end %>
        </table>
    </div>

    <div id="bottom">
        <div>
            <% login_str=%{?l=#{@request[:l]}&p=#{@request[:p]}} %>
            <a href="/accounts<%=login_str%>">Accounts list</a>
            .
            <a href="/users<%=login_str%>">Users list</a>
        </div>
    <div id="gprefs">
    2009 GridPocketÂ© SAS All Rights Reserved
    </div>
    <div id="promotion">
        Designed by <a href="http://yannesposito.com">Yann Esposito</a> &amp; <a href="http://lucarea.com">Luc Juggery</a>. Done with the <em>Rubyzome</em> framework.
    </div>
    </div>
</body>
</html>

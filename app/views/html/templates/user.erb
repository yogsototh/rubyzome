<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="/css/main.css" />
    <script type="text/javascript" src="/js/jquery-1.3.1.min.js"></script>
    <script type="text/javascript" src="/js/jquery.cookie.js"></script>
    <script type="text/javascript" src="/js/index.js"></script>
    <title><%= @title %></title>
    <script>
        function getUrlVars()
        {
            var vars = [], hash;
            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for(var i = 0; i < hashes.length; i++)
            {
                hash = hashes[i].split('=');
                vars.push(hash[0]);
                vars[hash[0]] = hash[1];
            }
            return vars;
        }

        function draw_graphic( data ) {
            // draw something inside $('#graph')
        }


        $(document).ready(function(){
            var params = getUrlVars();
            var login=params['l'];
            var password=params['p'];
            var prefix_url='/users/'+login+'/sensors';
            var login = { "l": login, "p" : password };

            $.getJSON(prefix_url+'.json', 
                login , 
                function(json){
                    // only for first sensor
                    sensor=json[0]["sensor_hr"];
                    var one_hour_ago=new Date((new Date).getTime() - 3600000)
                    var last_measure_param = { "l": login, "p" : password, "from" : one_hour_ago.toString() };
                    $.get(prefix_url+'/'+sensor+'/measures.json', login, function(measure) {
                        // draw_graphic( measure.consumptions )
                        alert(measure);
                });
            });
        });

    </script>
</head>
<body>
    <div id="entete">
        <h1><%= @title %></h1>
        <h2><%= @subtitle %></h2>
    </div>

    <div id="content">
        <%= @content %>
    </div>

    <div id="bottom">
    <div id="gprefs">
    2009 GridPocketÂ© SAS All Rights Reserved
    </div>
    <div id="promotion">
    Designed by <a href="http://yannesposito.com">Yann Esposito</a> &amp; <a href="http://lucarea.com">Luc Juggery</a>.
    </div>
    </div>
</body>
</html>
